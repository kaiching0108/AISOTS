{% extends "base.html" %}

{% block title %}éƒ¨ä½æŸ¥è©¢ - AISOTS{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">ğŸ“¦ éƒ¨ä½åˆ—è¡¨</div>
    <div id="positionList">
        <div class="loading">è¼‰å…¥ä¸­...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function loadPositions() {
        try {
            const response = await fetch('/api/positions');
            const data = await response.json();
            
            if (!data.success || !data.data || data.data.length === 0) {
                document.getElementById('positionList').innerHTML = '<div class="empty-state">ç›®å‰æ²’æœ‰éƒ¨ä½</div>';
                return;
            }
            
            document.getElementById('positionList').innerHTML = `
                <div style="margin-bottom: 15px; font-weight: bold;">
                    ç¸½å£æ•¸: ${data.summary.total_quantity} | ç¸½æç›Š: <span class="${data.summary.total_pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                        ${data.summary.total_pnl >= 0 ? '+' : ''}${data.summary.total_pnl.toLocaleString()}
                    </span>
                </div>
            ` + data.data.map(p => `
                <div class="position-item">
                    <div>
                        <strong>${p.symbol}</strong> ${p.direction} ${p.quantity}å£
                        <div style="font-size: 12px; color: #666;">
                            é€²å ´: ${p.entry_price} â†’ ç¾åƒ¹: ${p.current_price}
                        </div>
                    </div>
                    <div class="${p.pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}" style="font-size: 18px; font-weight: bold;">
                        ${p.pnl >= 0 ? '+' : ''}${p.pnl.toLocaleString()}
                    </div>
                </div>
            `).join('');
        } catch (e) {
            console.error(e);
            document.getElementById('positionList').innerHTML = '<div class="empty-state">è¼‰å…¥å¤±æ•—</div>';
        }
    }
    
    loadPositions();
    setInterval(loadPositions, REFRESH_INTERVAL);
</script>
{% endblock %}
