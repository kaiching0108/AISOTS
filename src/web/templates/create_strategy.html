{% extends "base.html" %}

{% block title %}å‰µå»ºç­–ç•¥ - AISOTS{% endblock %}

{% block extra_css %}
<style>
    .create-strategy-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .strategy-panel {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .panel-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 2px solid #3498db;
        color: #2c3e50;
    }
    
    .form-row {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        align-items: flex-start;
    }
    
    .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .form-group label {
        font-size: 14px;
        font-weight: 500;
        color: #555;
        margin-bottom: 6px;
    }
    
    .form-group label .required {
        color: #e74c3c;
    }
    
    .form-group select,
    .form-group input {
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.2s;
    }
    
    .form-group select:focus,
    .form-group input:focus {
        outline: none;
        border-color: #3498db;
    }
    
    .form-group textarea {
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
        resize: vertical;
        min-height: 120px;
        transition: border-color 0.2s;
    }
    
    .form-group textarea:focus {
        outline: none;
        border-color: #3498db;
    }
    
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
    }
    
    .btn-primary:hover {
        background: #2980b9;
    }
    
    .btn-success {
        background: #27ae60;
        color: white;
    }
    
    .btn-success:hover {
        background: #219a52;
    }
    
    .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
    }
    
    .button-group {
        display: flex;
        gap: 12px;
        margin-top: 20px;
    }
    
    .loading {
        text-align: center;
        padding: 40px;
        color: #666;
    }
    
    .loading::after {
        content: '';
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #3498db;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 10px;
        vertical-align: middle;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .result-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 16px;
        border-radius: 6px;
        margin-top: 16px;
    }
    
    .result-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 16px;
        border-radius: 6px;
        margin-top: 16px;
    }
    
    .verification-stage {
        margin: 12px 0;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 6px;
    }
    
    .verification-stage.passed {
        background: #d4edda;
    }
    
    .verification-stage.failed {
        background: #f8d7da;
    }
    
    .stage-status {
        font-weight: 600;
    }
    
    .stage-status.passed::before {
        content: 'âœ… ';
    }
    
    .stage-status.failed::before {
        content: 'âŒ ';
    }
    
    .backtest-chart {
        max-width: 100%;
        margin-top: 16px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .hidden {
        display: none;
    }
    
    .hint {
        font-size: 12px;
        color: #888;
        margin-top: 4px;
    }
    
    /* é€²åº¦æ¢æ¨£å¼ */
    .progress-container {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .progress-message {
        font-size: 14px;
        color: #333;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
    }
    
    .progress-message::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        background: #3498db;
        border-radius: 50%;
        margin-right: 10px;
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.4; }
    }
    
    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        border-radius: 4px;
        transition: width 0.3s ease;
        width: 0%;
    }
    
    .progress-steps {
        display: flex;
        justify-content: space-between;
        margin-top: 12px;
        font-size: 12px;
        color: #888;
    }
    
    .progress-step {
        text-align: center;
        flex: 1;
    }
    
    .progress-step.active {
        color: #3498db;
        font-weight: 600;
    }
    
    .progress-step.completed {
        color: #27ae60;
    }
</style>
{% endblock %}

{% block content %}
<div class="create-strategy-container">
    <h1 style="margin-bottom: 24px;">å‰µå»ºæ–°ç­–ç•¥</h1>
    
        <!-- ä¸Šè¦–çª—ï¼šç”¨æˆ¶è¼¸å…¥ -->
    <div class="strategy-panel" id="inputPanel">
        <div class="panel-title">ğŸ“ è¼¸å…¥ç­–ç•¥åƒæ•¸</div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 0 0 200px;">
                <label>æœŸè²¨ä»£ç¢¼ <span class="required">*</span></label>
                <select id="symbol" required>
                    <option value="">é¸æ“‡...</option>
                    <option value="TXF">TXF (å¤§å°)</option>
                    <option value="MXF">MXF (å°å°)</option>
                    <option value="TMF">TMF (å¾®å°)</option>
                </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 150px;">
                <label>æ™‚é–“æ¡†æ¶</label>
                <select id="timeframe">
                    <option value="1m">1 åˆ†é˜</option>
                    <option value="5m">5 åˆ†é˜</option>
                    <option value="15m" selected>15 åˆ†é˜</option>
                    <option value="30m">30 åˆ†é˜</option>
                    <option value="60m">1 å°æ™‚</option>
                    <option value="1d">1 æ—¥</option>
                </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 120px;">
                <label>å£æ•¸</label>
                <input type="number" id="quantity" value="1" min="1" max="10">
            </div>
            
            <div class="form-group" style="flex: 0 0 180px;">
                <label>äº¤æ˜“æ–¹å‘</label>
                <select id="direction">
                    <option value="long" selected>åšå¤š (Long)</option>
                    <option value="short">åšç©º (Short)</option>
                    <option value="both">å¤šç©ºéƒ½åš</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 0 0 150px;">
                <label>åœæ (ç‚¹)</label>
                <input type="number" id="stopLoss" placeholder="ä¾‹å¦‚: 30">
            </div>
            
            <div class="form-group" style="flex: 0 0 150px;">
                <label>æ­¢ç›ˆ (ç‚¹)</label>
                <input type="number" id="takeProfit" placeholder="ä¾‹å¦‚: 50">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>ç­–ç•¥æç¤ºè© <span class="required">*</span></label>
                <textarea id="prompt" placeholder="æè¿°æ‚¨çš„äº¤æ˜“ç­–ç•¥...
ä¾‹å¦‚ï¼š
- æ¯æ—¥èµš500å…ƒ
- RSIä½äº30ä¹°å…¥ï¼ŒRSIé«˜äº70å–å‡º
- å‡çº¿äº¤å‰ç­–ç•¥
- å¸ƒæ—é€šé“çªç ´ç­–ç•¥

æ‚¨å¯ä»¥è¾“å…¥å®Œæ•´çš„ç­–ç•¥æè¿°ï¼Œä¹Ÿå¯ä»¥åªè¾“å…¥ç›®æ ‡ï¼ˆå¦‚ï¼šæ¯æ—¥èµš500å…ƒï¼‰ï¼Œç³»ç»Ÿä¼šå¸®æ‚¨æ¨æ–­å‚æ•°ã€‚"></textarea>
                <div class="hint">è¾“å…¥æ‚¨çš„äº¤æ˜“ç­–ç•¥æƒ³æ³•ï¼Œæè¿°è¶Šè¯¦ç»†è¶Šå¥½ã€‚ç³»ç»Ÿä¼šæ ¹æ®æ‚¨çš„è¾“å…¥æ¨æ–­åˆé€‚çš„å‚æ•°ã€‚</div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" id="generateBtn" onclick="generatePreview()">
                âœ¨ Generate - è®© LLM å¡«å……å‚æ•°
            </button>
        </div>
    </div>
    
    <!-- ä¸‹è§†çª—ï¼šLLM å»ºè®® / ç”¨æˆ·ç¢ºèª -->
    <div class="strategy-panel hidden" id="previewPanel">
        <div class="panel-title">ğŸ¤– LLM å»ºè®® / ç¢ºèª</div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 1;">
                <label>ç­–ç•¥åç¨± <span style="color: #666; font-size: 12px;">(å¯ä¿®æ”¹)</span></label>
                <input type="text" id="previewName" placeholder="ç­–ç•¥åç¨±" style="width: 100%;">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 0 0 200px;">
                <label>æœŸè²¨ä»£ç¢¼</label>
                <select id="previewSymbol">
                    <option value="TXF">TXF (å¤§å°)</option>
                    <option value="MXF">MXF (å°å°)</option>
                    <option value="TMF">TMF (å¾®å°)</option>
                </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 150px;">
                <label>æ™‚é–“æ¡†æ¶</label>
                <select id="previewTimeframe">
                    <option value="1m">1 åˆ†é˜</option>
                    <option value="5m">5 åˆ†é˜</option>
                    <option value="15m">15 åˆ†é˜</option>
                    <option value="30m">30 åˆ†é˜</option>
                    <option value="60m">1 å°æ™‚</option>
                    <option value="1d">1 æ—¥</option>
                </select>
            </div>
            
            <div class="form-group" style="flex: 0 0 120px;">
                <label>å£æ•¸</label>
                <input type="number" id="previewQuantity" min="1" max="10">
            </div>
            
            <div class="form-group" style="flex: 0 0 180px;">
                <label>äº¤æ˜“æ–¹å‘</label>
                <select id="previewDirection">
                    <option value="long">åšå¤š (Long)</option>
                    <option value="short">åšç©º (Short)</option>
                    <option value="both">å¤šç©ºéƒ½åš</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group" style="flex: 0 0 150px;">
                <label>åœæ (ç‚¹)</label>
                <input type="number" id="previewStopLoss">
            </div>
            
            <div class="form-group" style="flex: 0 0 150px;">
                <label>æ­¢ç›ˆ (ç‚¹)</label>
                <input type="number" id="previewTakeProfit">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>ç­–ç•¥æè¿° (Prompt)</label>
                <textarea id="previewPrompt"></textarea>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn btn-success" id="confirmBtn" onclick="confirmStrategy()">
                âœ… ç¢ºèªå¹¶ç”Ÿæˆç­–ç•¥ä»£ç 
            </button>
            <button class="btn btn-primary" onclick="showInputPanel()">
                â† è¿”å›ä¿®æ”¹
            </button>
        </div>
    </div>
    
    <!-- é©—è­‰ç»“æœé¡¯ç¤º -->
    <div class="strategy-panel hidden" id="resultPanel">
        <div class="panel-title">ğŸ“Š é©—è­‰ç»“æœ</div>
        
        <div id="verificationContent">
            <div class="loading">æ­£åœ¨é©—è­‰ç­–ç•¥...</div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function showInputPanel() {
    document.getElementById('inputPanel').classList.remove('hidden');
    document.getElementById('previewPanel').classList.add('hidden');
    document.getElementById('resultPanel').classList.add('hidden');
}

function showPreviewPanel() {
    document.getElementById('inputPanel').classList.add('hidden');
    document.getElementById('previewPanel').classList.remove('hidden');
    document.getElementById('resultPanel').classList.add('hidden');
}

function showResultPanel() {
    document.getElementById('inputPanel').classList.add('hidden');
    document.getElementById('previewPanel').classList.add('hidden');
    document.getElementById('resultPanel').classList.remove('hidden');
}

async function generatePreview() {
    const symbol = document.getElementById('symbol').value;
    const prompt = document.getElementById('prompt').value;
    const direction = document.getElementById('direction').value;
    
    if (!symbol) {
        alert('è¯·é¸æ“‡æœŸè²¨ä»£ç¢¼');
        return;
    }
    if (!prompt) {
        alert('è¯·è¾“å…¥ç­–ç•¥æç¤ºè©');
        return;
    }
    
    const btn = document.getElementById('generateBtn');
    btn.disabled = true;
    btn.textContent = 'è™•ç†ä¸­...';
    
    try {
        const response = await fetch('/api/strategies/preview', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                symbol: symbol,
                prompt: prompt,
                direction: direction,
                timeframe: document.getElementById('timeframe').value,
                stop_loss: document.getElementById('stopLoss').value || null,
                take_profit: document.getElementById('takeProfit').value || null,
                quantity: parseInt(document.getElementById('quantity').value) || 1
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // å¡«å……ä¸‹è§†çª—
            document.getElementById('previewSymbol').value = data.data.symbol;
            document.getElementById('previewName').value = data.data.suggested_name || ('ç­–ç•¥_' + data.data.symbol);
            document.getElementById('previewTimeframe').value = data.data.timeframe;
            document.getElementById('previewQuantity').value = data.data.quantity;
            document.getElementById('previewStopLoss').value = data.data.stop_loss || '';
            document.getElementById('previewTakeProfit').value = data.data.take_profit || '';
            document.getElementById('previewPrompt').value = data.data.prompt;
            
            // è¨­ç½®äº¤æ˜“æ–¹å‘
            if (data.data.direction) {
                document.getElementById('previewDirection').value = data.data.direction;
            }
            
            showPreviewPanel();
        } else {
            alert('ç”Ÿæˆé¢„è§ˆå¤±æ•—: ' + data.message);
        }
    } catch (error) {
        alert('è«‹æ±‚å¤±æ•—: ' + error.message);
    } finally {
        btn.disabled = false;
        btn.textContent = 'âœ¨ Generate - è®© LLM å¡«å……å‚æ•°';
    }
}

async function confirmStrategy() {
    const btn = document.getElementById('confirmBtn');
    btn.disabled = true;
    btn.textContent = 'è™•ç†ä¸­...';
    
    showResultPanel();
    
    const verificationContent = document.getElementById('verificationContent');
    
    // é¡¯ç¤ºé€²åº¦æ¢ï¼ˆå‡é€²åº¦å‹•ç•«ï¼‰
    let currentProgress = 0;
    const progressSteps = [
        { percent: 15, message: 'ğŸ”„ æ­£åœ¨å»ºç«‹ç­–ç•¥...', step: 1 },
        { percent: 35, message: 'ğŸ“ æ­£åœ¨ç”Ÿæˆç­–ç•¥ç¨‹å¼ç¢¼...', step: 2 },
        { percent: 55, message: 'ğŸ” æ­£åœ¨é€²è¡Œ LLM å¯©æŸ¥...', step: 3 },
        { percent: 75, message: 'ğŸ“Š æ­£åœ¨é€²è¡Œæ­·å²å›æ¸¬...', step: 4 },
        { percent: 90, message: 'ğŸ“ˆ æ­£åœ¨æ•´ç†çµæœ...', step: 5 }
    ];
    
    verificationContent.innerHTML = `
        <div class="progress-container">
            <div class="progress-message" id="progressMessage">æ­£åœ¨æº–å‚™...</div>
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step active" id="step1">1. å»ºç«‹ç­–ç•¥</div>
                <div class="progress-step" id="step2">2. ç”Ÿæˆä»£ç¢¼</div>
                <div class="progress-step" id="step3">3. LLM å¯©æŸ¥</div>
                <div class="progress-step" id="step4">4. æ­·å²å›æ¸¬</div>
                <div class="progress-step" id="step5">5. å®Œæˆ</div>
            </div>
        </div>
    `;
    
    // å•Ÿå‹•å‡é€²åº¦å‹•ç•«
    let stepIndex = 0;
    const progressInterval = setInterval(() => {
        if (stepIndex < progressSteps.length) {
            const step = progressSteps[stepIndex];
            updateProgressUI(step.step, step.message, step.percent);
            stepIndex++;
        }
    }, 3000); // æ¯ 3 ç§’æ›´æ–°ä¸€æ¬¡é€²åº¦
    
    try {
        // å‘¼å«æ™®é€š JSON APIï¼ˆé SSEï¼‰
        const response = await fetch('/api/strategies/confirm', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: document.getElementById('previewName').value,
                symbol: document.getElementById('previewSymbol').value,
                prompt: document.getElementById('previewPrompt').value,
                direction: document.getElementById('previewDirection').value,
                timeframe: document.getElementById('previewTimeframe').value,
                stop_loss: document.getElementById('previewStopLoss').value || null,
                take_profit: document.getElementById('previewTakeProfit').value || null,
                quantity: parseInt(document.getElementById('previewQuantity').value) || 1
            })
        });
        
        const data = await response.json();
        
        // åœæ­¢å‡é€²åº¦å‹•ç•«
        clearInterval(progressInterval);
        
        // å®Œæˆæ™‚è·³åˆ° 100%
        updateProgressUI(5, 'âœ… å®Œæˆï¼', 100);
        
        // ç¨å¾®å»¶é²ä¸€ä¸‹å†é¡¯ç¤ºçµæœï¼Œè®“ç”¨æˆ¶çœ‹åˆ° 100%
        setTimeout(() => {
            displayResult(data);
            btn.disabled = false;
            btn.textContent = 'âœ… ç¢ºèªå¹¶ç”Ÿæˆç­–ç•¥ä»£ç ';
        }, 500);
        
    } catch (error) {
        clearInterval(progressInterval);
        verificationContent.innerHTML = '<div class="result-error">è«‹æ±‚å¤±æ•—: ' + error.message + '</div>';
        btn.disabled = false;
        btn.textContent = 'âœ… ç¢ºèªå¹¶ç”Ÿæˆç­–ç•¥ä»£ç ';
    }
}

function updateProgressUI(step, message, percent) {
    const progressBar = document.getElementById('progressBar');
    const progressMessage = document.getElementById('progressMessage');
    
    if (progressBar && progressMessage) {
        progressBar.style.width = percent + '%';
        progressMessage.textContent = message;
        
        // æ›´æ–°æ­¥é©Ÿç‹€æ…‹
        for (let i = 1; i <= 5; i++) {
            const stepEl = document.getElementById('step' + i);
            if (stepEl) {
                if (i < step) {
                    stepEl.className = 'progress-step completed';
                } else if (i === step) {
                    stepEl.className = 'progress-step active';
                } else {
                    stepEl.className = 'progress-step';
                }
            }
        }
    }
}

function displayResult(data) {
    const btn = document.getElementById('confirmBtn');
    btn.disabled = false;
    btn.textContent = 'âœ… ç¢ºèªå¹¶ç”Ÿæˆç­–ç•¥ä»£ç ';
    
    const verificationContent = document.getElementById('verificationContent');
    
    if (data.success) {
        let html = '<div class="result-success">';
        html += '<h3>âœ… ç­–ç•¥å·²æˆåŠŸåˆ›å»ºï¼</h3>';
        html += '<p><strong>ç­–ç•¥ ID:</strong> ' + data.data.strategy_id + '</p>';
        html += '<p><strong>ç­–ç•¥åç§°:</strong> ' + data.data.name + '</p>';
        
        // é©—è­‰ç»“æœ
        if (data.data.verification) {
            // Stage 1: LLM Review
            const stage1Class = data.data.verification.stage1_passed ? 'passed' : 'failed';
            html += '<div class="verification-stage ' + stage1Class + '">';
            html += '<div class="stage-status ' + stage1Class + '">Stage 1: LLM Review</div>';
            if (!data.data.verification.stage1_passed) {
                html += '<div>' + (data.data.verification.stage1_error || 'é©—è­‰å¤±æ•—') + '</div>';
            }
            html += '</div>';
            
            // Stage 2: Backtest
            if (data.data.verification.stage1_passed) {
                const stage2Class = data.data.verification.stage2_passed ? 'passed' : 'failed';
                html += '<div class="verification-stage ' + stage2Class + '">';
                html += '<div class="stage-status ' + stage2Class + '">Stage 2: Backtest</div>';
                if (data.data.verification.stage2_passed) {
                    // ä½¿ç”¨ iframe é¡¯ç¤ºå®Œæ•´å›æ¸¬ HTML åœ–è¡¨
                    if (data.data.chart_path) {
                        html += '<iframe src="' + data.data.chart_path + '" style="width:100%; height:600px; border:none; border-radius:8px; margin-top: 8px;"></iframe>';
                    }
                    
                    // é¡¯ç¤ºç­–ç•¥åˆ†æ
                    if (data.data.analysis) {
                        html += '<div style="margin-top: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 13px;">';
                        html += '<div style="white-space: pre-wrap; line-height: 1.4;">' + data.data.analysis + '</div>';
                        html += '</div>';
                    }
                } else {
                    html += '<div>' + (data.data.verification.stage2_error || 'å›æµ‹å¤±æ•—') + '</div>';
                }
                html += '</div>';
            }
        }
        
        html += '<div style="margin-top: 16px;">';
        html += '<a href="/strategies" class="btn btn-primary">æŸ¥çœ‹ç­–ç•¥åˆ—è¡¨</a> ';
        html += '<a href="/strategies/create" class="btn btn-success">ç¹¼çºŒå‰µå»º</a>';
        html += '</div>';
        html += '</div>';
        
        verificationContent.innerHTML = html;
    } else {
        let html = '<div class="result-error">';
        html += '<h3>âŒ ç­–ç•¥åˆ›å»ºå¤±æ•—</h3>';
        html += '<p>' + data.message + '</p>';
        
        if (data.data && data.data.verification) {
            if (data.data.verification.stage1_passed === false) {
                html += '<div class="verification-stage failed">';
                html += '<div class="stage-status failed">Stage 1: LLM Review - å¤±æ•—</div>';
                html += '<div>' + (data.data.verification.stage1_error || 'é©—è­‰å¤±æ•—') + '</div>';
                html += '</div>';
            }
            
            if (data.data.verification.stage1_passed && data.data.verification.stage2_passed === false) {
                html += '<div class="verification-stage failed">';
                html += '<div class="stage-status failed">Stage 2: Backtest - å¤±æ•—</div>';
                html += '<div>' + (data.data.verification.stage2_error || 'å›æµ‹å¤±æ•—') + '</div>';
                html += '</div>';
            }
        }
        
        html += '<div style="margin-top: 16px;">';
        html += '<button class="btn btn-primary" onclick="showInputPanel()">â† è¿”å›ä¿®æ”¹</button>';
        html += '</div>';
        html += '</div>';
        
        verificationContent.innerHTML = html;
    }
}
</script>
{% endblock %}
